services:
  - name: prod-api-gateway
    type: web
    runtime: node
    rootDir: apps/api-gateway
    buildCommand: npm install
    startCommand: npm start
    envVars:
      - key: PORT
        value: "3000"
      - key: AUTH_SERVICE_URL
        sync: false
      - key: PROFILE_SERVICE_URL
        sync: false
      - key: JOBS_SERVICE_URL
        sync: false
      - key: NOTIFICATIONS_SERVICE_URL
        sync: false
      - key: ADMIN_SERVICE_URL
        sync: false
      - key: AI_SERVICE_URL
        sync: false
      - key: CORS_ORIGIN
        sync: false

  - name: prod-auth-service
    type: web
    runtime: node
    rootDir: apps/auth-service
    buildCommand: npm install
    preDeployCommand: npm run generate && npm run migrate
    startCommand: npm start
    envVars:
      - key: PORT
        value: "3001"
      - key: JWT_SECRET
        sync: false
      - key: DATABASE_URL
        fromDatabase:
          name: prod-auth-db
          property: connectionString
      - key: PROFILE_SERVICE_URL
        sync: false
      - key: CORS_ORIGIN
        sync: false

  - name: prod-profile-service
    type: web
    runtime: node
    rootDir: apps/profile-service
    buildCommand: npm install
    preDeployCommand: npm run generate && npm run migrate
    startCommand: npm start
    envVars:
      - key: PORT
        value: "3002"
      - key: JWT_SECRET
        sync: false
      - key: DATABASE_URL
        fromDatabase:
          name: prod-profile-db
          property: connectionString
      - key: CORS_ORIGIN
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      - key: SUPABASE_BUCKET
        value: "resumes"

  - name: prod-jobs-service
    type: web
    runtime: node
    rootDir: apps/jobs-service
    buildCommand: npm install
    preDeployCommand: npm run generate && npm run migrate
    startCommand: npm start
    envVars:
      - key: PORT
        value: "3003"
      - key: JWT_SECRET
        sync: false
      - key: DATABASE_URL
        fromDatabase:
          name: prod-jobs-db
          property: connectionString
      - key: PROFILE_SERVICE_URL
        sync: false
      - key: NOTIFICATIONS_SERVICE_URL
        sync: false
      - key: AI_SERVICE_URL
        sync: false
      - key: CORS_ORIGIN
        sync: false
      - key: SHORTLIST_LIMIT
        value: "50"
      - key: SHORTLIST_MIN_SCORE
        value: "20"
      - key: SHORTLIST_NOTIFY_LIMIT
        value: "20"
      - key: NOTIFY_MATCHED
        value: "true"

  - name: prod-notifications-service
    type: web
    runtime: node
    rootDir: apps/notifications-service
    buildCommand: npm install
    preDeployCommand: npm run generate && npm run migrate
    startCommand: npm start
    envVars:
      - key: PORT
        value: "3004"
      - key: JWT_SECRET
        sync: false
      - key: DATABASE_URL
        fromDatabase:
          name: prod-notifications-db
          property: connectionString
      - key: AUTH_SERVICE_URL
        sync: false
      - key: PROFILE_SERVICE_URL
        sync: false
      - key: CORS_ORIGIN
        sync: false

  - name: prod-admin-service
    type: web
    runtime: node
    rootDir: apps/admin-service
    buildCommand: npm install
    preDeployCommand: npm run generate && npm run migrate
    startCommand: npm start
    envVars:
      - key: PORT
        value: "3005"
      - key: JWT_SECRET
        sync: false
      - key: DATABASE_URL
        fromDatabase:
          name: prod-admin-db
          property: connectionString
      - key: AUTH_SERVICE_URL
        sync: false
      - key: PROFILE_SERVICE_URL
        sync: false
      - key: JOBS_SERVICE_URL
        sync: false
      - key: NOTIFICATIONS_SERVICE_URL
        sync: false
      - key: CORS_ORIGIN
        sync: false
      - key: AUDIT_RETENTION_DAYS
        value: "90"

  - name: prod-ai-matching-service
    type: web
    runtime: node
    rootDir: apps/ai-matching-service
    buildCommand: npm install
    startCommand: npm start
    envVars:
      - key: PORT
        value: "3006"
      - key: PROFILE_SERVICE_URL
        sync: false
      - key: CORS_ORIGIN
        sync: false
      - key: AI_MIN_SCORE
        value: "20"
      - key: AI_DEFAULT_LIMIT
        value: "50"
      - key: AI_SUBSCRIPTION_BONUS
        value: "15"
      - key: AI_LOCATION_BONUS
        value: "15"

  - name: prod-web
    type: web
    runtime: static
    rootDir: apps/web
    buildCommand: npm install && npm run build
    staticPublishPath: dist
    envVars:
      - key: VITE_API_BASE_URL
        sync: false

databases:
  - name: prod-auth-db
    databaseName: workbridge_auth_db
    user: workbridge_auth
  - name: prod-profile-db
    databaseName: workbridge_profile_db
    user: workbridge_profile
  - name: prod-jobs-db
    databaseName: workbridge_jobs_db
    user: workbridge_jobs
  - name: prod-notifications-db
    databaseName: workbridge_notif_db
    user: workbridge_notif
  - name: prod-admin-db
    databaseName: workbridge_admin_db
    user: workbridge_admin
